{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://chirpstack-provisioning.schemas/setup.json",
  "title": "ChirpStack Setup Configuration",
  "description": "Schema for provisioning ChirpStack infrastructure including tenants, device profiles, applications, integrations, and gateways",
  "type": "object",
  "properties": {
    "tenants": {
      "type": "array",
      "description": "List of tenants to create or update",
      "items": {
        "$ref": "#/$defs/Tenant"
      }
    }
  },
  "$defs": {
    "Tenant": {
      "type": "object",
      "description": "ChirpStack tenant configuration",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Tenant name"
        },
        "*id": {
          "type": "string",
          "const": "AUTO-GENERATED",
          "description": "Tenant ID (UUID). This will be automatically generated on create"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Tenant description"
        },
        "can_have_gateways": {
          "type": "boolean",
          "description": "Can the tenant create and 'own' Gateways?",
          "default": true
        },
        "max_gateway_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Max gateway count for tenant. When set to 0, the tenant can have unlimited gateways",
          "default": 0
        },
        "max_device_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Max device count for tenant. When set to 0, the tenant can have unlimited devices",
          "default": 0
        },
        "private_gateways_up": {
          "type": "boolean",
          "description": "Private gateways (uplink). If enabled, uplink messages will not be shared with other tenants",
          "default": false
        },
        "private_gateways_down": {
          "type": "boolean",
          "description": "Private gateways (downlink). If enabled, other tenants will not be able to schedule downlink messages through the gateways of this tenant",
          "default": false
        },
        "tags": {
          "type": "object",
          "description": "Tags (user defined). These tags are NOT exposed in the integration events",
          "additionalProperties": {
            "type": "string"
          }
        },
        "gateways": {
          "type": "array",
          "description": "Gateways belonging to this tenant",
          "items": {
            "$ref": "#/$defs/Gateway"
          }
        },
        "applications": {
          "type": "array",
          "description": "Applications belonging to this tenant",
          "items": {
            "$ref": "#/$defs/Application"
          }
        },
        "_deviceProfiles": {
          "type": "array",
          "description": "Device profiles belonging to this tenant. Note: uses underscore prefix to indicate this is a referenced entity",
          "items": {
            "$ref": "#/$defs/DeviceProfile"
          }
        }
      },
      "required": ["name"],
      "additionalProperties": false
    },
    "Gateway": {
      "type": "object",
      "description": "ChirpStack LoRaWAN gateway configuration",
      "properties": {
        "gateway_id": {
          "type": "string",
          "pattern": "^[0-9A-Fa-f]{16}$",
          "description": "Gateway ID (EUI64) in hexadecimal format (16 characters)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Gateway name"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Gateway description"
        },
        "*tenant_id": {
          "type": "string",
          "const": "AUTO-PARENT",
          "description": "Tenant ID (UUID). This will be automatically filled from the parent tenant"
        },
        "tags": {
          "type": "object",
          "description": "Gateway tags for organization and filtering",
          "additionalProperties": {
            "type": "string"
          }
        },
        "metadata": {
          "type": "object",
          "description": "Gateway metadata (provided by the gateway)",
          "additionalProperties": {
            "type": "string"
          }
        },
        "stats_interval": {
          "type": "integer",
          "minimum": 1,
          "maximum": 86400,
          "description": "Stats interval in seconds. This defines the expected interval in which the gateway sends its statistics",
          "default": 30
        },
        "location": {
          "$ref": "#/$defs/Location"
        }
      },
      "required": ["gateway_id", "name"],
      "additionalProperties": false
    },
    "Location": {
      "type": "object",
      "description": "Gateway location information",
      "properties": {
        "latitude": {
          "type": "number",
          "minimum": -90,
          "maximum": 90,
          "description": "Latitude coordinate"
        },
        "longitude": {
          "type": "number",
          "minimum": -180,
          "maximum": 180,
          "description": "Longitude coordinate"
        },
        "altitude": {
          "type": "number",
          "description": "Altitude in meters"
        },
        "source": {
          "type": "string",
          "enum": ["UNKNOWN", "GPS", "CONFIG", "GEO_RESOLVER_TDOA", "GEO_RESOLVER_RSSI", "GEO_RESOLVER_GNSS", "GEO_RESOLVER_WIFI"],
          "description": "Location source"
        },
        "accuracy": {
          "type": "number",
          "description": "Location accuracy in meters"
        }
      },
      "additionalProperties": false
    },
    "Application": {
      "type": "object",
      "description": "ChirpStack application configuration",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Application name"
        },
        "*id": {
          "type": "string",
          "const": "AUTO-GENERATED",
          "description": "Application ID (UUID). This will be automatically generated on create"
        },
        "*tenant_id": {
          "type": "string",
          "const": "AUTO-PARENT",
          "description": "Tenant ID (UUID). This will be automatically filled from the parent tenant"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Application description"
        },
        "tags": {
          "type": "object",
          "description": "Tags (user defined). These tags are exposed in all integration events of devices under this application",
          "additionalProperties": {
            "type": "string"
          }
        },
        "_InfluxDbIntegration": {
          "$ref": "#/$defs/InfluxDbIntegration",
          "description": "InfluxDB integration configuration. Note: uses underscore prefix to indicate this is an integration"
        }
      },
      "required": ["name"],
      "additionalProperties": false
    },
    "InfluxDbIntegration": {
      "type": "object",
      "description": "InfluxDB integration configuration",
      "properties": {
        "*application_id": {
          "type": "string",
          "const": "AUTO-PARENT",
          "description": "Application ID (UUID). This will be automatically filled from the parent application"
        },
        "version": {
          "type": "integer",
          "enum": [0, 1],
          "description": "InfluxDB version: 0 = InfluxDB v1, 1 = InfluxDB v2",
          "default": 1
        },
        "endpoint": {
          "type": "string",
          "description": "InfluxDB API write endpoint (e.g. http://localhost:8086/write)"
        },
        "endpoint_env_var": {
          "type": "string",
          "description": "Environment variable containing the InfluxDB endpoint"
        },
        "db": {
          "type": "string",
          "description": "InfluxDB database name (InfluxDB v1 only)"
        },
        "username": {
          "type": "string",
          "description": "InfluxDB username (InfluxDB v1 only)"
        },
        "password": {
          "type": "string",
          "description": "InfluxDB password (InfluxDB v1 only)"
        },
        "retention_policy_name": {
          "type": "string",
          "description": "InfluxDB retention policy name (InfluxDB v1 only)"
        },
        "precision": {
          "type": "string",
          "enum": ["NS", "U", "MS", "S", "M", "H"],
          "description": "InfluxDB precision: NS=nanoseconds, U=microseconds, MS=milliseconds, S=seconds, M=minutes, H=hours",
          "default": "NS"
        },
        "token": {
          "type": "string",
          "description": "Token (InfluxDB v2 only)"
        },
        "token_env_var": {
          "type": "string",
          "description": "Environment variable containing the InfluxDB token (InfluxDB v2 only)"
        },
        "organization": {
          "type": "string",
          "description": "Organization (InfluxDB v2 only)"
        },
        "organization_env_var": {
          "type": "string",
          "description": "Environment variable containing the InfluxDB organization (InfluxDB v2 only)"
        },
        "bucket": {
          "type": "string",
          "description": "Bucket (InfluxDB v2 only)"
        },
        "bucket_env_var": {
          "type": "string",
          "description": "Environment variable containing the InfluxDB bucket (InfluxDB v2 only)"
        }
      },
      "required": ["version"],
      "additionalProperties": false
    },
    "DeviceProfile": {
      "type": "object",
      "description": "ChirpStack device profile configuration",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Device profile name"
        },
        "*id": {
          "type": "string",
          "const": "AUTO-GENERATED",
          "description": "Device profile ID (UUID). This will be automatically generated on create"
        },
        "*tenant_id": {
          "type": "string",
          "const": "AUTO-PARENT",
          "description": "Tenant ID (UUID). This will be automatically filled from the parent tenant"
        },
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "Device profile description"
        },
        "region": {
          "type": "string",
          "enum": ["EU868", "US915", "CN779", "EU433", "AU915", "CN470", "AS923", "AS923_2", "AS923_3", "AS923_4", "KR920", "IN865", "RU864", "ISM2400"],
          "description": "LoRaWAN region"
        },
        "mac_version": {
          "type": "string",
          "enum": ["LORAWAN_1_0_0", "LORAWAN_1_0_1", "LORAWAN_1_0_2", "LORAWAN_1_0_3", "LORAWAN_1_0_4", "LORAWAN_1_1_0"],
          "description": "LoRaWAN MAC version",
          "default": "LORAWAN_1_0_4"
        },
        "reg_params_revision": {
          "type": "string",
          "enum": ["A", "B", "RP002_1_0_0", "RP002_1_0_1", "RP002_1_0_2", "RP002_1_0_3", "RP002_1_0_4"],
          "description": "Regional parameters revision",
          "default": "RP002_1_0_1"
        },
        "supports_otaa": {
          "type": "boolean",
          "description": "Device supports OTAA (Over-The-Air Activation)",
          "default": true
        },
        "supports_class_b": {
          "type": "boolean",
          "description": "Device supports Class B",
          "default": false
        },
        "supports_class_c": {
          "type": "boolean",
          "description": "Device supports Class C",
          "default": false
        },
        "adr_algorithm_id": {
          "type": "string",
          "description": "ADR algorithm ID",
          "default": "default"
        },
        "payload_codec_runtime": {
          "type": "string",
          "enum": ["NONE", "CAYENNE_LPP", "JS"],
          "description": "Payload codec runtime: NONE, CAYENNE_LPP, or JS (JavaScript)",
          "default": "NONE"
        },
        "payload_codec_script": {
          "type": "string",
          "description": "Payload codec script (JavaScript code)"
        },
        "payload_codec_script_path": {
          "type": "string",
          "description": "Path to payload codec script file"
        },
        "flush_queue_on_activate": {
          "type": "boolean",
          "description": "Flush queue on device activation",
          "default": false
        },
        "uplink_interval": {
          "type": "integer",
          "minimum": 0,
          "description": "Expected uplink interval in seconds. When set to 0, no uplink interval is expected"
        },
        "device_status_req_interval": {
          "type": "integer",
          "minimum": 0,
          "description": "Device status request interval (times per day)"
        },
        "tags": {
          "type": "object",
          "description": "Tags (user defined). These tags are exposed in all integration events of devices using this device profile",
          "additionalProperties": {
            "type": "string"
          }
        },
        "auto_detect_measurements": {
          "type": "boolean",
          "description": "Auto-detect measurements from decoded payload",
          "default": true
        }
      },
      "required": ["name", "region", "mac_version", "reg_params_revision", "supports_otaa"],
      "additionalProperties": false
    }
  }
}
